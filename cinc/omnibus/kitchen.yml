#
# NOTE: this runs the omnibus cookbook, but does not actually run Omnibus. Use
# 'kichen converge' to setup the virtual machine and then `kitchen login` to
# SSH into the machine and run Omnibus.
#

driver:
  name: ec2
  region: eu-west-1
  availability_zone: c
  require_chef_omnibus: true
  interface: dns
  synced_folders:
    - ['../..', '/vagrant/code']
    - ['../../omnibus', '/home/vagrant/omnibus']
    - ['../../omnibus-software', '/home/vagrant/omnibus-software']

provisioner:
  name: chef_zero
  product_name: cinc
  product_version: latest
  chef_omnibus_root: /opt/cinc

platforms:
  - name: windows-2012r2
    driver:
      instance_type: t3.medium
      synced_folders:
      # We have to mount this repos enclosing folder as the Omnibus build
      # gets cranky if the mounted Chef source folder is a symlink. This
      # mounts at `C:\vagrant\code` and the Chef source folder is available
      # at `C:\vagrant\code\chef`
      - ['../..', '/vagrant/code']
      communicator: winrm
    transport:
      name: winrm
      elevated: true

suites:
  - name: chef
    attributes:
      omnibus:
        toolchain_channel: stable
        toolchain_version: latest
        install_dir: /opt/cinc
    run_list:
      - omnibus::default
